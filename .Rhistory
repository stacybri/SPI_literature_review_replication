) %>%
mutate(
date=as.numeric(str_sub(index,5,8))
) %>%
group_by(iso3c) %>%
fill(c('hdi_value'), .direction = 'downup') %>%
filter(date>=2021) %>% #take 5 latest years
summarise(across(c('hdi_value'), mean, na.rm=TRUE)) %>%
select(iso3c, hdi_value)
View(hdi_df)
hdi_df <- read_csv(paste0(raw_dir, 'HDR21-22_Composite_indices_complete_time_series.csv')) %>%
rename(iso3c=iso3) %>%
select(iso3c, hdi_1990:hdi_2021) %>%
pivot_longer(
cols=c('hdi_1990':'hdi_2021'),
names_to='index',
values_to='hdi_value'
) %>%
mutate(
date=as.numeric(str_sub(index,5,8))
) %>%
group_by(iso3c) %>%
fill(c('hdi_value'), .direction = 'downup') %>%
filter(date>=2021-4)
View(hdi_df)
epi_df <- read_csv(paste0(raw_dir, 'epi2022results05302022.csv'))
View(epi_df)
colnames(epi_df)
#Yale’s Environmental Performance Index (https://epi.yale.edu/).  Downloaded Aug 24, 2023
epi_df <- read_csv(paste0(raw_dir, 'epi2022results05302022.csv')) %>%
rename(iso3c=iso,
env_perform_index=EPI.new)
epi_2022_df <- read_csv(paste0(raw_dir, 'epi2022results05302022.csv')) %>%
rename(iso3c=iso,
env_perform_index=EPI.new) %>%
mutate(date=2022)
epi_2020_df <- read_csv(paste0(raw_dir, 'epi2020results.csv')) %>%
rename(iso3c=iso,
env_perform_index=EPI.new) %>%
mutate(date=2020)
epi_2018_df <- read_csv(paste0(raw_dir, 'epi2018results.csv'))
colnames(epi_2018_df)
ec_complex_df <- read_csv(paste0(raw_dir, "Country Complexity Rankings 1995 - 2021.csv"))
View(ec_complex_df)
View(ec_complex_df)
ec_complex_df <- read_csv(paste0(raw_dir, "Country Complexity Rankings 1995 - 2021.csv"))
View(ec_complex_df)
colnames(ec_complex_df)
ec_complex_df <- read_csv(paste0(raw_dir, "Country Complexity Rankings 1995 - 2021.csv")) %>%
select(iso3c, `ECI 1995`:`ECI 2021`) %>%
pivot_longer(
cols=c('ECI 1995':'ECI 2021'),
names_to='index',
values_to='eci_value'
) %>%
mutate(
date=as.numeric(str_sub(index,5,8))
)
View(ec_complex_df)
press_free_df <- read_delim(paste0(raw_dir, "press_freedom_2023.csv"), delim=";")
View(press_free_df)
View(press_free_df)
press_free_df <- bind_rows(
read_delim(paste0(raw_dir, "press_freedom_2023.csv"), delim=";"),
read_delim(paste0(raw_dir, "press_freedom_2022.csv"), delim=";"),
read_delim(paste0(raw_dir, "press_freedom_2021.csv"), delim=";"),
read_delim(paste0(raw_dir, "press_freedom_2020.csv"), delim=";"),
read_delim(paste0(raw_dir, "press_freedom_2019.csv"), delim=";"),
read_delim(paste0(raw_dir, "press_freedom_2018.csv"), delim=";")
)
View(press_free_df)
colnames(press_free_df)
press_free_df <- bind_rows(
read_delim(paste0(raw_dir, "press_freedom_2023.csv"), delim=";"),
read_delim(paste0(raw_dir, "press_freedom_2022.csv"), delim=";"),
read_delim(paste0(raw_dir, "press_freedom_2021.csv"), delim=";"),
read_delim(paste0(raw_dir, "press_freedom_2020.csv"), delim=";"),
read_delim(paste0(raw_dir, "press_freedom_2019.csv"), delim=";"),
read_delim(paste0(raw_dir, "press_freedom_2018.csv"), delim=";")
) %>%
transmute(
iso3c=ISO,
press_free_score=Score,
date=`Year (N)`
)
View(press_free_df)
View(press_free_df)
bli_df <- read_csv(paste0(raw_dir, 'BLI_20230824.csv'))
View(bli_df)
View(bli_df)
colnames(bli_df)
bli_df <- read_csv(paste0(raw_dir, 'BLI_20230824.csv')) %>%
rename(iso3c=LOCATION) %>%
#combine indicators with equal weight
group_by(iso3c) %>%
summarise(better_life_index=mean(Value))
View(bli_df)
bli_df <- read_csv(paste0(raw_dir, 'BLI_20230824.csv'))
View(bli_df)
knitr::opts_chunk$set(
echo = TRUE,
message = FALSE,
warning = FALSE,
fig.height=6,
fig.width = 8,
dev=c("png","tiff")
)
library(data.table)
library(tidyverse)
library(flextable)
library(here)
library(haven)
library(wbstats)
library(readxl)
library(zoo)
#devtools::install_github("worldbank/pipr")
library(pipr) #World Bank PIP package
dir <- here()
raw_dir <- paste0(dir, "/01_raw_data/")
output_dir <- paste(dir, '/03_output/', sep="/")
#weights (either unity (1) or population)
wgt <- 1
end_date=2022
#| label: pipdata
#read in PIP data for Figure 1 from the paper.
#new pipr package already includes survey coverage and comparability measures
pip_df <- get_stats()
# get mean consumption/income per day as of latest year (mean)
welfare_df <- pip_df %>%
filter(survey_coverage %in% c('national')) %>% #keep just the national surveys
filter(reporting_level %in% c('national')) %>% #keep just the national survey
rename(iso3c=country_code,
mean_welfare=mean) %>%
group_by(iso3c) %>%
filter(year==max(year)) %>%
#keep consumption survey for Poland, Haiti, Angola, PHL
filter(!(iso3c=="POL" & welfare_type=='income'))    %>%
filter(!(iso3c=="HTI" & welfare_type=='income'))    %>%
filter(!(iso3c=="AGO" & welfare_type=='income'))    %>%
filter(!(iso3c=="PHL" & welfare_type=='income'))    %>%
select(iso3c, mean_welfare)
#reshape the data
pip_df <- pip_df %>%
filter(survey_coverage %in% c('national')) %>% #keep just the national surveys
filter(reporting_level %in% c('national')) %>% #keep just the national surveys
filter(between(year, 1982, 2022)) %>% #keep data from 1982 to 2022
#aggregate totals by country
rename(iso3c=country_code) %>%
group_by(iso3c) %>%
summarise(
number_surveys=n(),
avg_mean_welfare = mean(mean)
) #get counts of the number of surveys by country
#add welfare
pip_df <- pip_df %>%
left_join(welfare_df)
#save
write_excel_csv(pip_df, paste0(output_dir, "/Figure_1_data.csv"))
#add in population
pop_df <- wbstats::wb_data(country="all",
indicator='SP.POP.TOTL',
start_date=2004,
end_date=end_date) %>%
mutate(date=as.numeric(date)) %>%
mutate(population=SP.POP.TOTL) %>%
select(country, date, population)
#import data
spi_index_df <- read_csv(paste(raw_dir, 'SPI_index.csv', sep="/")) %>%
left_join(pop_df)
spi_df_final <- read_csv( file = paste(raw_dir, 'SPI_data.csv', sep="/")) %>%
left_join(pop_df)
#metadata
metadata <- data.frame(
series = c('SPI.INDEX', 'SPI.INDEX.PIL1', 'SPI.INDEX.PIL2', 'SPI.INDEX.PIL3', 'SPI.INDEX.PIL4', 'SPI.INDEX.PIL5'),
indicator_name = c('SPI Overall Score', 'Pillar 1: Data Use', 'Pillar 2: Data Services', 'Pillar 3: Data Products', 'Pillar 4: Data Sources', 'Pillar 5: Data Infrastructure')
)
#get list of country info
country_list <- wbstats::wb_countries()
write_excel_csv(country_list, paste0(raw_dir, "country_metadata.csv"))
SPI_end_date <- spi_index_df %>%
filter(date==end_date) %>%
filter(!is.na(SPI.INDEX) & !is.na(weights)) %>%
mutate(ISO_A3_EH=iso3c)
SPI <- spi_index_df
#read in TopoJSON from World Bank
#countries <- geojsonio::geojson_read("WB_countries_Admin0_lowres.geojson",
#                                     what = "sp")
span <- c(2004:end_date)
#produce an empty dataset with the right number of rows (country X year observations)
spi_df_empty <- bind_rows(replicate(length(span), wbstats::wbcountries(), simplify = FALSE), .id='date') %>%
mutate(date=as.numeric(date)+span[1]-1) %>%
filter(region!="Aggregates") # take out the aggregates (LAC, SAR, etc)
start_date=2010
correlates_df <- wb_data(country="all",
indicator=c('SI.POV.DDAY', 'SI.POV.GINI'),
start_date=start_date,
end_date=end_date,
) %>% # fill forward
group_by(country) %>%
right_join(spi_df_empty) %>%
fill(c('SI.POV.DDAY', 'SI.POV.GINI'), .direction = 'downup') %>%
filter(date==end_date)
ge_df <- wb_data(country="all",
indicator=c('GE.EST'),
start_date=start_date,
end_date=end_date,
) %>% # fill forward
group_by(country) %>%
right_join(spi_df_empty) %>%
fill(c('GE.EST'), .direction = 'downup') %>%
filter(date==end_date) %>%
select(iso3c, date, GE.EST)
gdp_df <- wb_data(country="all",
indicator=c('NY.GDP.PCAP.KD'),
start_date=start_date,
end_date=end_date,
) %>% # fill forward
group_by(country) %>%
right_join(spi_df_empty) %>%
fill(c('NY.GDP.PCAP.KD'), .direction = 'downup') %>%
filter(date==end_date) %>%  select(iso3c, date, NY.GDP.PCAP.KD)
hci_df <- wb_data(country="all",
indicator=c('HD.HCI.OVRL'),
start_date=start_date,
end_date=end_date,
) %>% # fill forward
group_by(country) %>%
right_join(spi_df_empty) %>%
fill(c('HD.HCI.OVRL'), .direction = 'downup') %>%
filter(date==end_date) %>%
select(iso3c, HD.HCI.OVRL)
undernourish_df <- wb_data(country="all",
indicator=c('SN.ITK.DEFC.ZS'),
start_date=start_date,
end_date=end_date,
) %>% # fill forward
group_by(country) %>%
right_join(spi_df_empty) %>%
fill(c('SN.ITK.DEFC.ZS'), .direction = 'downup') %>%
filter(date==end_date) %>%
select(iso3c, date, SN.ITK.DEFC.ZS)
mmt_df <-  wb_data(country="all",
indicator=c('SH.STA.MMRT'),
start_date=start_date,
end_date=end_date,
) %>% # fill forward
group_by(country) %>%
right_join(spi_df_empty) %>%
fill(c('SH.STA.MMRT'), .direction = 'downup') %>%
filter(date==end_date) %>%
select(iso3c,  SH.STA.MMRT)
lpov_df <-  wb_data(country="all",
indicator=c('SE.LPV.PRIM'),
start_date=start_date,
end_date=end_date,
) %>% # fill forward
group_by(country) %>%
right_join(spi_df_empty) %>%
fill(c('SE.LPV.PRIM'), .direction = 'downup') %>%
filter(date==end_date)  %>%
select(iso3c, date, SE.LPV.PRIM)
wbl_df <- wb_data(country="all",
indicator=c('SG.LAW.INDX'),
start_date=start_date,
end_date=end_date,
) %>% # fill forward
group_by(country) %>%
right_join(spi_df_empty) %>%
fill(c('SG.LAW.INDX'), .direction = 'downup') %>%
filter(date==end_date) %>%
select(iso3c, date, SG.LAW.INDX)
safely_df <- wb_data(country="all",
indicator=c('SH.H2O.SMDW.ZS'),
start_date=start_date,
end_date=end_date,
) %>% # fill forward
group_by(country) %>%
right_join(spi_df_empty) %>%
fill(c('SH.H2O.SMDW.ZS'), .direction = 'downup') %>%
filter(date==end_date) %>%
select(iso3c, date, SH.H2O.SMDW.ZS)
elect_df <- wb_data(country="all",
indicator=c('EG.ELC.ACCS.ZS'),
start_date=start_date,
end_date=end_date,
) %>% # fill forward
group_by(country) %>%
right_join(spi_df_empty) %>%
fill(c('EG.ELC.ACCS.ZS'), .direction = 'downup') %>%
filter(date==end_date) %>%
select(iso3c, date, EG.ELC.ACCS.ZS)
manuf_df <- wb_data(country="all",
indicator=c('NV.IND.MANF.ZS'),
start_date=start_date,
end_date=end_date,
) %>% # fill forward
group_by(country) %>%
right_join(spi_df_empty) %>%
fill(c('NV.IND.MANF.ZS'), .direction = 'downup') %>%
filter(date==end_date) %>%
select(iso3c, date, NV.IND.MANF.ZS)
slums_df <- wb_data(country="all",
indicator=c('EN.POP.SLUM.UR.ZS'),
start_date=start_date,
end_date=end_date,
) %>% # fill forward
group_by(country) %>%
right_join(spi_df_empty) %>%
fill(c('EN.POP.SLUM.UR.ZS'), .direction = 'downup') %>%
filter(date==end_date) %>%
select(iso3c,  EN.POP.SLUM.UR.ZS)
ff_sub_df <- read_csv(paste0(raw_dir, "/Subsidies.csv")) %>%
rename(iso3c=code)
ghg_df <- wb_data(country="all",
indicator=c('EN.ATM.GHGT.KT.CE'),
start_date=start_date,
end_date=end_date,
) %>% # fill forward
group_by(country) %>%
right_join(spi_df_empty) %>%
fill(c('EN.ATM.GHGT.KT.CE'), .direction = 'downup') %>%
filter(date==end_date) %>%
select(iso3c,  EN.ATM.GHGT.KT.CE)
protected_df <- wb_data(country="all",
indicator=c('ER.MRN.PTMR.ZS','ER.LND.PTLD.ZS'),
start_date=start_date,
end_date=end_date,
) %>% # fill forward
group_by(country) %>%
fill(c('ER.MRN.PTMR.ZS','ER.LND.PTLD.ZS'), .direction = 'downup') %>%
filter(date==end_date) %>%
select(iso3c, date, ER.MRN.PTMR.ZS,ER.LND.PTLD.ZS)
debt_df <- wb_data(country="all",
indicator=c('DT.TDS.DECT.EX.ZS'),
start_date=start_date,
end_date=end_date,
) %>% # fill forward
group_by(country) %>%
fill(c('DT.TDS.DECT.EX.ZS'), .direction = 'downup') %>%
filter(date==end_date) %>%
select(iso3c, date, DT.TDS.DECT.EX.ZS)
#bring in Sachs SDG index
#https://dashboards.sdgindex.org/explorer
# accessed on 2023-07-20
sdg_index <- read_excel(path=paste0(raw_dir, "/SDR2023-data.xlsx"),
sheet='Backdated SDG Index'
) %>%
transmute(iso3c=`Country Code ISO3`,
date=year,
sdg_index_score=`SDG Index Score`) %>%
group_by(iso3c) %>%
fill(c('sdg_index_score'), .direction = 'downup') %>%
filter(date>=end_date) %>% #take 5 latest years
summarise(across(c('sdg_index_score'), mean, na.rm=TRUE)) %>%
select(iso3c, sdg_index_score)
#the UN’s HDI (https://hdr.undp.org/data-center/human-development-index#/indicies/HDI).  Downloaded Aug 24, 2023
hdi_df <- read_csv(paste0(raw_dir, 'HDR21-22_Composite_indices_complete_time_series.csv')) %>%
rename(iso3c=iso3) %>%
select(iso3c, hdi_1990:hdi_2021) %>%
pivot_longer(
cols=c('hdi_1990':'hdi_2021'),
names_to='index',
values_to='hdi_value'
) %>%
mutate(
date=as.numeric(str_sub(index,5,8))
) %>%
group_by(iso3c) %>%
fill(c('hdi_value'), .direction = 'downup') %>%
filter(date>=2021) %>% #take 5 latest years
summarise(across(c('hdi_value'), mean, na.rm=TRUE)) %>%
select(iso3c, hdi_value)
#Yale’s Environmental Performance Index (https://epi.yale.edu/).  Downloaded Aug 24, 2023
epi_2022_df <- read_csv(paste0(raw_dir, 'epi2022results05302022.csv')) %>%
rename(iso3c=iso,
env_perform_index=EPI.new) %>%
mutate(date=2022) %>%
select(iso3c, date, env_perform_index)
epi_2020_df <- read_csv(paste0(raw_dir, 'epi2020results.csv')) %>%
rename(iso3c=iso,
env_perform_index=EPI.new) %>%
mutate(date=2020) %>%
select(iso3c, date, env_perform_index)
epi_2018_df <- read_csv(paste0(raw_dir, 'epi2018results.csv')) %>%
rename(iso3c=iso,
env_perform_index=EPI.current) %>%
mutate(date=2018) %>%
select(iso3c, date, env_perform_index)
epi_df <- bind_rows(epi_2022_df, epi_2020_df, epi_2018_df) %>%
group_by(iso3c) %>%
fill(c('env_perform_index'), .direction = 'downup') %>%
filter(date>=2022) %>% #take 5 latest years
summarise(across(c('env_perform_index'), mean, na.rm=TRUE)) %>%
select(iso3c, env_perform_index)
##Harvard’s Economic complexity index (https://atlas.cid.harvard.edu/rankings).  Downloaded Aug 24, 2023
ec_complex_df <- read_csv(paste0(raw_dir, "Country Complexity Rankings 1995 - 2021.csv")) %>%
select(iso3c, `ECI 1995`:`ECI 2021`) %>%
pivot_longer(
cols=c('ECI 1995':'ECI 2021'),
names_to='index',
values_to='eci_value'
) %>%
mutate(
date=as.numeric(str_sub(index,5,8))
) %>%
group_by(iso3c) %>%
fill(c('eci_value'), .direction = 'downup') %>%
filter(date>=2021) %>% #take 5 latest years
summarise(across(c('eci_value'), mean, na.rm=TRUE)) %>%
select(iso3c, eci_value)
#World press freedom index (https://rsf.org/en/index).  Downloaded Aug 24, 2023
press_free_df <- bind_rows(
read_delim(paste0(raw_dir, "press_freedom_2023.csv"), delim=";"),
read_delim(paste0(raw_dir, "press_freedom_2022.csv"), delim=";"),
read_delim(paste0(raw_dir, "press_freedom_2021.csv"), delim=";"),
read_delim(paste0(raw_dir, "press_freedom_2020.csv"), delim=";"),
read_delim(paste0(raw_dir, "press_freedom_2019.csv"), delim=";"),
read_delim(paste0(raw_dir, "press_freedom_2018.csv"), delim=";")
) %>%
transmute(
iso3c=ISO,
press_free_score=Score,
date=`Year (N)`
) %>%
group_by(iso3c) %>%
fill(c('press_free_score'), .direction = 'downup') %>%
filter(date>=2023) %>% #take 5 latest years
summarise(across(c('press_free_score'), mean, na.rm=TRUE)) %>%
select(iso3c, eci_value)
##Harvard’s Economic complexity index (https://atlas.cid.harvard.edu/rankings).  Downloaded Aug 24, 2023
ec_complex_df <- read_csv(paste0(raw_dir, "Country Complexity Rankings 1995 - 2021.csv")) %>%
select(iso3c, `ECI 1995`:`ECI 2021`) %>%
pivot_longer(
cols=c('ECI 1995':'ECI 2021'),
names_to='index',
values_to='eci_value'
) %>%
mutate(
date=as.numeric(str_sub(index,5,8))
) %>%
group_by(iso3c) %>%
fill(c('eci_value'), .direction = 'downup') %>%
filter(date>=2021) %>% #take 5 latest years
summarise(across(c('eci_value'), mean, na.rm=TRUE)) %>%
select(iso3c, eci_value)
#World press freedom index (https://rsf.org/en/index).  Downloaded Aug 24, 2023
press_free_df <- bind_rows(
read_delim(paste0(raw_dir, "press_freedom_2023.csv"), delim=";"),
read_delim(paste0(raw_dir, "press_freedom_2022.csv"), delim=";"),
read_delim(paste0(raw_dir, "press_freedom_2021.csv"), delim=";"),
read_delim(paste0(raw_dir, "press_freedom_2020.csv"), delim=";"),
read_delim(paste0(raw_dir, "press_freedom_2019.csv"), delim=";"),
read_delim(paste0(raw_dir, "press_freedom_2018.csv"), delim=";")
) %>%
transmute(
iso3c=ISO,
press_free_score=Score,
date=`Year (N)`
) %>%
group_by(iso3c) %>%
fill(c('press_free_score'), .direction = 'downup') %>%
filter(date>=2023) %>% #take 5 latest years
summarise(across(c('press_free_score'), mean, na.rm=TRUE)) %>%
select(iso3c, press_free_score)
#OECD’s better life index (https://www.oecdbetterlifeindex.org/#/11111111111).  Downloaded Aug 24, 2023.  Only one year of data as not comparable over time.
bli_df <- read_csv(paste0(raw_dir, 'BLI_20230824.csv')) %>%
rename(iso3c=LOCATION) %>%
#combine indicators with equal weight
group_by(iso3c) %>%
summarise(better_life_index=mean(Value))
#bring it all together
correlates_df_end_date <- correlates_df %>%
left_join(ge_df) %>%
left_join(gdp_df) %>%
left_join(hci_df) %>%
left_join(undernourish_df) %>%
left_join(mmt_df) %>%
left_join(lpov_df) %>%
left_join(wbl_df) %>%
left_join(safely_df) %>%
left_join(elect_df) %>%
left_join(manuf_df) %>%
left_join(slums_df) %>%
left_join(ff_sub_df) %>%
left_join(ghg_df) %>%
left_join(protected_df) %>%
left_join(debt_df) %>%
left_join(sdg_index) %>%
left_join(hdi_df) %>%
left_join(epi_df) %>%
left_join(ec_complex_df) %>%
left_join(press_free_df) %>%
filter(region!="Aggregates") %>%
select(iso3c, c('SI.POV.DDAY', 'SI.POV.GINI','GE.EST','NY.GDP.PCAP.KD','HD.HCI.OVRL','SN.ITK.DEFC.ZS','SH.STA.MMRT','SE.LPV.PRIM','SG.LAW.INDX','SH.H2O.SMDW.ZS',"EG.ELC.ACCS.ZS",'NV.IND.MANF.ZS','EN.POP.SLUM.UR.ZS','subsidies','EN.ATM.GHGT.KT.CE','ER.MRN.PTMR.ZS','ER.LND.PTLD.ZS','DT.TDS.DECT.EX.ZS', 'sdg_index_score', 'hdi_value', 'env_perform_index', 'eci_value', 'press_free_score'))
bli_df <- read_csv(paste0(raw_dir, 'BLI_20230824.csv')) %>%
rename(iso3c=LOCATION)
colnames(bli_df)
View(bli_df)
unique(bli_df$INDICATOR)
unique(bli_df$Indicator)
bli_df <- read_csv(paste0(raw_dir, 'BLI_20230824.csv')) %>%
rename(iso3c=LOCATION) %>%
#zscore all indicators
group_by(Indicator) %>%
mutate(zscore=(Value-mean(Value, na.rm=TRUE))/sd(Value, na.rm=TRUE)) %>%
#combine indicators with equal weight
group_by(iso3c) %>%
summarise(better_life_index=mean(zscore))
View(bli_df)
bli_df <- read_csv(paste0(raw_dir, 'BLI_20230824.csv')) %>%
rename(iso3c=LOCATION)
View(bli_df)
