"0","#| label: volatilityplt1"
"0",""
"0","volatility_scatter_df <- volatility_df %>%"
"0","  select(-country, income, region) %>% #avoid conflicts with naming/income groups"
"0","  filter(date==2016 | date==2022) %>%"
"0","  as_tibble() %>%"
"0","  pivot_longer("
"0","    cols=c('SPI.INDEX', 'ODIN_score'),"
"0","    names_to='indicator',"
"0","    values_to='value'"
"0","  ) %>%"
"0","  pivot_wider("
"0","    values_from='value',"
"0","    names_from='date',"
"0","    names_prefix='value_'"
"0","  ) %>%"
"0","  mutate(indicator=case_when("
"0","    indicator=='ODIN_score' ~ ""ODIN Score"","
"0","    indicator==""SPI.INDEX"" ~ ""SPI Overall Score"""
"0","  ))"
"0",""
"0","# give a name to a formula"
"0","spi_vol_df <- volatility_scatter_df %>%"
"0","  filter(indicator==""SPI Overall Score"")"
"0",""
"0","odin_vol_df <- volatility_scatter_df %>%"
"0","  filter(indicator==""ODIN Score"")"
"0",""
"0","#get reg output"
"0","data = spi_vol_df"
"0","inp = 'value_2022'"
"0","var = 'value_2016'"
"0",""
"0","eq <- lm_robust(value_2022 ~ value_2016, data=data, se_type='HC2')"
"0","coef <- round(coef(eq),1)"
"0","std_err <- round(sqrt(diag(vcov(eq))),1)"
"0","r_2<- round(summary(eq)$r.squared,2)"
"0","spi_text <- sprintf("" y = %.1f + %.1f x, R<sup>2</sup> = %.2f <br> (%.1f) <span style='color:white'> %s</span> (%.1f) "", coef[1], coef[2], r_2[1], std_err[1],""s"", std_err[2])"
"0",""
"0","#odin reg output"
"0","data = odin_vol_df"
"0","inp = 'value_2022'"
"0","var = 'value_2016'"
"0",""
"0","eq <- lm_robust(value_2022 ~ value_2016, data=data, se_type='HC2')"
"0","coef <- round(coef(eq),1)"
"0","std_err <- round(sqrt(diag(vcov(eq))),1)"
"0","r_2<- round(summary(eq)$r.squared,2)"
"0","odin_text <- sprintf("" y = %.1f + %.1f x, R<sup>2</sup> = %.2f <br> (%.1f) <span style='color:white'> %s</span> (%.1f) "", coef[1], coef[2], r_2[1], std_err[1],""s"", std_err[2])"
"0",""
"0","#plot"
"0","p1 <- ggplot(volatility_scatter_df, aes(x=value_2016, y=value_2022,color=indicator, group=indicator)) +"
"0","  geom_point() +"
"0","  geom_smooth( method='lm', se=FALSE) +"
"0","  scale_color_manual("
"0","    values=c("
"0","      'ODIN Score' = ""darkred"","
"0","      'SPI Overall Score' =""blue"" "
"0","    )"
"0","  ) +  "
"0","  #stat_poly_eq() +"
"0","  geom_richtext("
"0","    aes(x = 10, y = 95,label = spi_text, hjust=0.2), colour=""blue"", size=2"
"0","  ) +"
"0","  geom_richtext("
"0","    aes(x = 55, y = 15,label = odin_text, hjust=0.2), colour=""darkred"", size=2"
"0","  ) +"
"0",""
"0","  # labs("
"0","  #   title='Volatility Between 2016 and 2020 for SCI and SPI Overall Scores'"
"0","  # ) +"
"0","  xlab('2016 value') +"
"0","  ylab('2022 value') +"
"0","  expand_limits(x=c(0,100), y=c(0,100)) +"
"0","  theme_spi()"
"0","    "
