"0","#add in population"
"0","pop_df <- wbstats::wb_data(country=""all"","
"0","             indicator='SP.POP.TOTL',"
"0","             start_date=2004,"
"0","             end_date=end_date) %>%"
"0","  mutate(date=as.numeric(date)) %>%"
"0","  mutate(population=SP.POP.TOTL) %>%"
"0","  select(country, date, population) "
"0","#import data"
"0","spi_index_df <- read_csv(paste(raw_dir, 'SPI_index.csv', sep=""/"")) %>%"
"0","    left_join(pop_df) "
"0",""
"0",""
"0","spi_df_final <- read_csv( file = paste(raw_dir, 'SPI_data.csv', sep=""/"")) %>%"
"0","  left_join(pop_df) "
"0","#metadata "
"0","metadata <- data.frame("
"0","  series = c('SPI.INDEX', 'SPI.INDEX.PIL1', 'SPI.INDEX.PIL2', 'SPI.INDEX.PIL3', 'SPI.INDEX.PIL4', 'SPI.INDEX.PIL5'),"
"0","  indicator_name = c('SPI Overall Score', 'Pillar 1: Data Use', 'Pillar 2: Data Services', 'Pillar 3: Data Products', 'Pillar 4: Data Sources', 'Pillar 5: Data Infrastructure')"
"0",")"
"0","#get list of country info"
"0","country_list <- wbstats::wb_countries()"
"0",""
"0",""
"0","SPI_end_date <- spi_index_df %>%"
"0","  filter(date==end_date) %>%"
"0","  filter(!is.na(SPI.INDEX) & !is.na(weights)) %>%"
"0","  mutate(ISO_A3_EH=iso3c) "
"0",""
"0",""
"0","SPI <- spi_index_df"
"0","#read in TopoJSON from World Bank"
"0","#countries <- geojsonio::geojson_read(""WB_countries_Admin0_lowres.geojson"","
"0","#                                     what = ""sp"")"
