"0","#| label: pipdata"
"0",""
"0","#read in PIP data for Figure 1 from the paper."
"0","#new pipr package already includes survey coverage and comparability measures"
"0","pip_df <- get_stats()"
"0",""
"0","# get mean consumption/income per day as of latest year (mean)"
"0","welfare_df <- pip_df %>%"
"0","  filter(survey_coverage %in% c('national')) %>% #keep just the national surveys"
"0","  filter(reporting_level %in% c('national')) %>% #keep just the national survey"
"0","  rename(iso3c=country_code,"
"0","         mean_welfare=mean) %>%"
"0","  group_by(iso3c) %>%"
"0","  filter(year==max(year)) %>%"
"0","  #keep consumption survey for Poland, Haiti, Angola, PHL"
"0","  filter(!(iso3c==""POL"" & welfare_type=='income'))    %>%"
"0","  filter(!(iso3c==""HTI"" & welfare_type=='income'))    %>%"
"0","  filter(!(iso3c==""AGO"" & welfare_type=='income'))    %>%"
"0","  filter(!(iso3c==""PHL"" & welfare_type=='income'))    %>%"
"0","  select(iso3c, mean_welfare)  "
"0",""
"0","#reshape the data"
"0","pip_df <- pip_df %>%"
"0","  filter(survey_coverage %in% c('national')) %>% #keep just the national surveys"
"0","  filter(reporting_level %in% c('national')) %>% #keep just the national surveys"
"0","  filter(between(year, 1982, 2022)) %>% #keep data from 1982 to 2022"
"0","  #aggregate totals by country"
"0","  rename(iso3c=country_code) %>%"
"0","  group_by(iso3c) %>%"
"0","  summarise("
"0","    number_surveys=n(),"
"0","    avg_mean_welfare = mean(mean)"
"0","  ) #get counts of the number of surveys by country "
"0",""
"0","#add welfare"
"0","pip_df <- pip_df %>%"
"0","  left_join(welfare_df)"
"0",""
"0","#save"
"0","write_excel_csv(pip_df, paste0(output_dir, ""/Figure_1_data.csv""))"
"0",""
