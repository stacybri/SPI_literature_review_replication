"0",""
"0",""
"0",""
"0","#pull SCI values"
"0",""
"0","sci_df <- read_excel(paste0(raw_dir, ""Statistical_Capacity_Indicators.xlsx"")) %>%"
"0","  mutate(YR2004=as.numeric(YR2004),"
"0","         iso3c=`Country Code`) %>%"
"0","  filter(`Series Code`==""IQ.SCI.OVRL"") %>%"
"0","  select(-`Country Code`, -`Series Code`) %>%"
"0","  pivot_longer("
"0","    cols=c(YR2004:YR2020),"
"0","    names_to='YR',"
"0","    values_to='SCI'"
"0","  ) %>%"
"0","  mutate(date=str_remove_all(YR,""YR""),"
"0","         date=as.numeric(date)) %>%"
"0","  select(iso3c, date, SCI)"
"0","  "
"0","  "
"0","  "
"0",""
"0","# onvert it to a data frame."
"0","sci_df <- sci_df %>%"
"0","  left_join(spi_df_empty) %>% #add on country metadata"
"0","  filter(!is.na(income)) %>%"
"0","  select(iso3c, date, SCI  ) %>%"
"0","  group_by(date) %>%"
"0","  arrange(-SCI) %>%"
"0","  mutate(SCI_rank=rank(-SCI),"
"0","         SCI_rank=if_else(is.na(SCI),as.numeric(NA),SCI_rank)) "
"0","  "
"0","#write to csv"
"0","write_excel_csv(sci_df, paste0(output_dir, ""/SCI_formatted_data.csv""))"
"0",""
"0",""
"0","#read in ODIN data"
"0","  for (i in c(2015,2016,2017,2018,2020,2022)) {"
"0","   temp <- read_csv(paste(raw_dir, '/','ODIN_',i,'.csv', sep=""""))  %>%"
"0","        as_tibble(.name_repair = 'universal') %>%"
"0","        mutate(date=i) %>%"
"0","        filter(Data.categories=='All Categories') %>%"
"0","        select(-Year)"
"0",""
"0",""
"0","    assign(paste('odin_df',i,sep=""_""), temp)"
"0","  }"
"0",""
"0","    #bind different years together"
"0","odin_df <- bind_rows(odin_df_2015, odin_df_2016, odin_df_2017, odin_df_2018, odin_df_2020, odin_df_2022)"
"0",""
"0",""
"0","odin_df <- odin_df %>%"
"0","    select(Country.Code, date, Overall.score) %>%"
"0","    rename(iso3c=Country.Code,"
"0","           ODIN_score=Overall.score) %>%"
"0","    group_by(date) %>%"
"0","    arrange(-ODIN_score) %>%"
"0","    mutate(ODIN_rank=rank(-ODIN_score, na.last='NA')) %>% "
"0","  right_join(spi_df_empty) %>%"
"0","  arrange(country, date) %>%"
"0","  group_by(country) %>%"
"0","  mutate(across(starts_with(""ODIN""), na.locf, na.rm=FALSE)) %>%"
"0","  left_join(wbstats::wb_countries()) %>%"
"0","  select(iso3c, date, starts_with(""ODIN""))"
"0",""
"0","#write to csv"
"0","write_excel_csv(odin_df, paste0(output_dir, ""/ODIN_formatted_data.csv""))"
"0",""
"0","#read in the ODB"
"0","odb_df_2017 <- read_excel(path=paste0(raw_dir, '/Open Data Barometer - Historical Data (All five Editions) - Public.xlsx'),"
"0","                     sheet='ODB-2017-Rankings') %>%"
"0","  transmute("
"0","    iso3c=ISO3,"
"0","    odb=`ODB-Score`"
"0","  )"
"0",""
"0",""
"0","odb_df_2016_info <- read_excel(path=paste0(raw_dir, '/Open Data Barometer - Historical Data (All five Editions) - Public.xlsx'),"
"0","                     sheet='ODB-2016-Rankings') %>%"
"0","  select(ISO3, Country) "
"0",""
"0","odb_df_2016 <- read_excel(path=paste0(raw_dir, '/Open Data Barometer - Historical Data (All five Editions) - Public.xlsx'),"
"0","                     sheet='ODB-2016-Absolute-Recalculated') %>%"
"0","  left_join(odb_df_2016_info) %>%"
"0","  transmute("
"0","    iso3c=ISO3,"
"0","    odb_2016=`ODB Score (0-100)`"
"0","  )"
"0",""
"0","odb_df_2015 <- read_excel(path=paste0(raw_dir, '/Open Data Barometer - Historical Data (All five Editions) - Public.xlsx'),"
"0","                     sheet='ODB-2015-Rankings')"
"0","odb_df_2014 <- read_excel(path=paste0(raw_dir, '/Open Data Barometer - Historical Data (All five Editions) - Public.xlsx'),"
"0","                     sheet='ODB-2014-Rankings')"
"0","odb_df_2013 <- read_excel(path=paste0(raw_dir, '/Open Data Barometer - Historical Data (All five Editions) - Public.xlsx'),"
"0","                     sheet='ODB-2013-Rankings')"
"0",""
"0","odb_df <- bind_rows("
"0","  (odb_df_2017 %>% mutate(date=2017)),"
"0","  (odb_df_2016 %>% mutate(date=2016, odb=odb_2016)),"
"0","  (odb_df_2015 %>% mutate(date=2015, iso3c=ISO3, odb=`ODB-Score-Scaled`)),"
"0","  (odb_df_2014 %>% mutate(date=2014, iso3c=ISO3, odb=`ODB-Score-Scaled`)),"
"0","  (odb_df_2013 %>% mutate(date=2013, iso3c=ISO3, odb=`ODB-Score-Scaled`)),"
"0","  ) %>%"
"0","  select(iso3c, date, odb) %>%"
"0","  left_join(country_list)"
"0",""
"0","#write to csv"
"0","write_excel_csv(odb_df, paste0(output_dir, ""/ODB_formatted_data.csv""))"
"0",""
"0","#read in the GDB"
"0","gdb_df <- read_csv(paste0(raw_dir, ""/global-data-barometer-topic--all-countries.csv"")) %>%"
"0","  transmute(iso3c=iso,"
"0","            gdb=`GDB 2021 score`)"
"0",""
"0","gdb_reg_df <- gdb_df %>% "
"0","  mutate(date=2021) %>%"
"0","  select(iso3c, date, gdb) %>%"
"0","  left_join(country_list)"
"0",""
"0","#write to csv"
"0","write_excel_csv(gdb_reg_df, paste0(output_dir, ""/GDB_formatted_data.csv""))"
"0",""
"0","#IIAG"
"0","iiag_df <- read_csv(paste0(raw_dir, ""/2022 IIAG_Scores.csv"")) %>%"
"0","  filter(Year==2022) %>%"
"0","  transmute("
"0","    iso2c=Country_ISO,"
"0","    iiag_overall=`OVERALL GOVERNANCE`,"
"0","    iiag_stats=`Capacity of the Statistical System`"
"0","  ) %>%"
"0","  left_join(country_list) %>%"
"0","  select(iso3c,iiag_overall,iiag_stats )"
"0","  "
"0","#write to csv"
"0","write_excel_csv(iiag_df, paste0(output_dir, ""/IIAG_formatted_data.csv""))"
"0",""
"0",""
"0","#create one database"
"0","comparison_df <- spi_index_df %>%"
"0","  ungroup() %>%"
"0","  filter(date ==end_date) %>%"
"0","  arrange(-SPI.INDEX) %>%"
"0","  mutate(across(starts_with('SPI.INDEX'),~1*.),"
"0","         across(starts_with('SPI.INDEX'),round,1)) %>%"
"0","  select(country, iso3c, date, income, region, SPI.INDEX) %>%"
"0","  left_join(sci_df %>% filter(date==2020) %>% ungroup() %>% select(-date)) %>%"
"0","  left_join(odin_df) %>%"
"0","  left_join(odb_df_2017) %>%"
"0","  left_join(odb_df_2016) %>%"
"0","  mutate(odb=if_else(is.na(odb),odb_2016,odb)) %>%"
"0","  left_join(gdb_df) %>%"
"0","  left_join(iiag_df) %>%"
"0","  left_join(correlates_df_end_date)"
"0",""
"0","#save to output"
"0","write_excel_csv(comparison_df, paste0(output_dir, ""/SPI_Index_SDG_comparisons_data.csv""))"
"0",""
"0",""
